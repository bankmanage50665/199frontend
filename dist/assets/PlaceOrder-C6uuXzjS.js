import{r as y,S as k,j as e,b as m,B as u}from"./index-C-R8sGom.js";import{T as b}from"./Title-CtaHhv0M.js";import{C as R}from"./CartTotal-DbXek670.js";const D=()=>{const[h,N]=y.useState("cod"),{navigate:f,backendUrl:c,token:i,cartItems:p,setCartItems:g,getCartAmount:j,delivery_fee:w,products:v}=y.useContext(k),[t,C]=y.useState({firstName:"",lastName:"",email:"",street:"",city:"",state:"",zipcode:"",country:"",phone:""}),s=o=>{const n=o.target.name,d=o.target.value;C(r=>({...r,[n]:d}))},z=o=>{const n={key:"-------- Paste Razorpay key Id --------",amount:o.amount,currency:o.currency,name:"Order Payment",description:"Order Payment",order_id:o.id,receipt:o.receipt,handler:async r=>{console.log(r);try{const{data:a}=await m.post(c+"/api/order/verifyRazorpay",r,{headers:{token:i}});a.success&&(f("/orders"),g({}))}catch(a){console.log(a),u.error(a)}}};new window.Razorpay(n).open()},E=async o=>{o.preventDefault();try{let n=[];for(const r in p)for(const a in p[r])if(p[r][a]>0){const l=structuredClone(v.find(x=>x._id===r));l&&(l.size=a,l.quantity=p[r][a],n.push(l))}let d={address:t,items:n,amount:j()+w};switch(h){case"cod":const r=await m.post(c+"/api/order/place",d,{headers:{token:i}});r.data.success?(g({}),f("/orders")):u.error(r.data.message);break;case"stripe":const a=await m.post(c+"/api/order/stripe",d,{headers:{token:i}});if(a.data.success){const{session_url:x}=a.data;window.location.replace(x)}else u.error(a.data.message);break;case"razorpay":const l=await m.post(c+"/api/order/razorpay",d,{headers:{token:i}});l.data.success&&z(l.data.order);break;default:break}}catch(n){console.log(n),u.error(n.message)}};return e.jsxs("form",{onSubmit:E,className:"flex flex-col sm:flex-row justify-between gap-4 pt-5 sm:pt-14 min-h-[80vh] border-t",children:[e.jsxs("div",{className:"flex flex-col gap-4 w-full sm:max-w-[480px]",children:[e.jsx("div",{className:"text-xl sm:text-2xl my-3",children:e.jsx(b,{text1:"DELIVERY",text2:"INFORMATION"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{required:!0,onChange:s,name:"firstName",value:t.firstName,className:"border border-gray-300 rounded py-1.5 px-3.5 w-full",type:"text",placeholder:"First name"}),e.jsx("input",{required:!0,onChange:s,name:"lastName",value:t.lastName,className:"border border-gray-300 rounded py-1.5 px-3.5 w-full",type:"text",placeholder:"Last name"})]}),e.jsx("input",{required:!0,onChange:s,name:"email",value:t.email,className:"border border-gray-300 rounded py-1.5 px-3.5 w-full",type:"email",placeholder:"Email address"}),e.jsx("input",{required:!0,onChange:s,name:"street",value:t.street,className:"border border-gray-300 rounded py-1.5 px-3.5 w-full",type:"text",placeholder:"Street"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{required:!0,onChange:s,name:"city",value:t.city,className:"border border-gray-300 rounded py-1.5 px-3.5 w-full",type:"text",placeholder:"City"}),e.jsx("input",{onChange:s,name:"state",value:t.state,className:"border border-gray-300 rounded py-1.5 px-3.5 w-full",type:"text",placeholder:"State"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{required:!0,onChange:s,name:"zipcode",value:t.zipcode,className:"border border-gray-300 rounded py-1.5 px-3.5 w-full",type:"number",placeholder:"Zipcode"}),e.jsx("input",{required:!0,onChange:s,name:"country",value:t.country,className:"border border-gray-300 rounded py-1.5 px-3.5 w-full",type:"text",placeholder:"Country"})]}),e.jsx("input",{required:!0,onChange:s,name:"phone",value:t.phone,className:"border border-gray-300 rounded py-1.5 px-3.5 w-full",type:"number",placeholder:"Phone"})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("div",{className:"mt-8 min-w-80",children:e.jsx(R,{})}),e.jsxs("div",{className:"mt-12",children:[e.jsx(b,{text1:"PAYMENT",text2:"METHOD"}),e.jsx("div",{className:"flex gap-3 flex-col lg:flex-row",children:e.jsxs("div",{onClick:()=>N("cod"),className:"flex items-center gap-3 border p-2 px-3 cursor-pointer",children:[e.jsx("p",{className:`min-w-3.5 h-3.5 border rounded-full ${h==="cod"?"bg-green-400":""}`}),e.jsx("p",{className:"text-gray-500 text-sm font-medium mx-4",children:"CASH ON DELIVERY"})]})}),e.jsx("div",{className:"w-full text-end mt-8",children:e.jsx("button",{type:"submit",className:"bg-black text-white px-16 py-3 text-sm",children:"PLACE ORDER"})})]})]})]})};export{D as default};
